function rgb2hex(e){var t=e.replace("rgb(","").replace(")","").split(",").map(e=>+e);return function(e){return new Array(7-e.length).join("0")+e}((t[0]<<16|t[1]<<8|t[2]).toString(16).toUpperCase())}var dispatch=d3.dispatch("addSelectedColor","clearPalette","deletePaletteColor","updateGradientColors","updateJNDParameters","updateSelectedColor"),colorVisionDeficiency=function(){var e=[3.240712470389558,-.969259258688888,.05563600315398933,-1.5372626602963142,1.875996969313966,-.2039948802843549,-.49857440415943116,.041556132211625726,1.0570636917433989],t=[.41242371206635076,.21265606784927693,.019331987577444885,.3575793401363035,.715157818248362,.11919267420354762,.1804662232369621,.0721864539171564,.9504491124870351],a={protan:{x:.7465,y:.2535,m:1.273463,yi:-.073894},deutan:{x:1.4,y:-.4,m:.968437,yi:.003331},tritan:{x:.1748,y:0,m:.062921,yi:.292119},custom:{x:.735,y:.265,m:-1.059259,yi:1.026914}},l=function(e){var a=t,l={},r=e.R/255,o=e.G/255,n=e.B/255;return r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,l.X=r*a[0]+o*a[3]+n*a[6],l.Y=r*a[1]+o*a[4]+n*a[7],l.Z=r*a[2]+o*a[5]+n*a[8],l},r=function(e){var t=e.X+e.Y+e.Z;return 0===t?{x:0,y:0,Y:e.Y}:{x:e.X/t,y:e.Y/t,Y:e.Y}},o=function(t,o,n){var c,i,d,s,p,u,h,f,g,v,b,y,m,C,S,x,k,w,P,T,O;return"achroma"===o?(c=.212656*t.R+.715158*t.G+.072186*t.B,c={R:c,G:c,B:c},n&&(d=(i=1.75)+1,c.R=(i*c.R+t.R)/d,c.G=(i*c.G+t.G)/d,c.B=(i*c.B+t.B)/d),c):(s=a[o],p=r(l(t)),u=(p.y-s.y)/(p.x-s.x),h=p.y-p.x*u,f=(s.yi-h)/(u-s.m),g=u*f+h,0,c={},c.X=f*p.Y/g,c.Y=p.Y,c.Z=(1-(f+g))*p.Y/g,w=.312713*p.Y/.329016,P=.358271*p.Y/.329016,v=w-c.X,b=P-c.Z,T=e,y=v*T[0]+0*T[3]+b*T[6],m=v*T[1]+0*T[4]+b*T[7],C=v*T[2]+0*T[5]+b*T[8],c.R=c.X*T[0]+c.Y*T[3]+c.Z*T[6],c.G=c.X*T[1]+c.Y*T[4]+c.Z*T[7],c.B=c.X*T[2]+c.Y*T[5]+c.Z*T[8],S=((c.R<0?0:1)-c.R)/y,x=((c.G<0?0:1)-c.G)/m,k=((c.B<0?0:1)-c.B)/C,S=S>1||S<0?0:S,x=x>1||x<0?0:x,k=k>1||k<0?0:k,O=S>x?S:x,k>O&&(O=k),c.R+=O*y,c.G+=O*m,c.B+=O*C,c.R=255*(c.R<=0?0:c.R>=1?1:Math.pow(c.R,1/2.2)),c.G=255*(c.G<=0?0:c.G>=1?1:Math.pow(c.G,1/2.2)),c.B=255*(c.B<=0?0:c.B>=1?1:Math.pow(c.B,1/2.2)),n&&(d=(i=1.75)+1,c.R=(i*c.R+t.R)/d,c.G=(i*c.G+t.G)/d,c.B=(i*c.B+t.B)/d),c)},n={protanomaly:{type:"protan",anomalize:!0},protanopia:{type:"protan"},deuteranomaly:{type:"deutan",anomalize:!0},deuteranopia:{type:"deutan"},tritanomaly:{type:"tritan",anomalize:!0},tritanopia:{type:"tritan"},achromatomaly:{type:"achroma",anomalize:!0},achromatopsia:{type:"achroma"}},c={cvdTypes:n,colorTransforms:{}};for(var i in n)c.colorTransforms[i]=function(e){return function(t){var a=d3.rgb(t);if(a){var l=new o({R:a.r,G:a.g,B:a.b},n[e].type,n[e].anomalize);return l.R=l.R||0,l.G=l.G||0,l.B=l.B||0,d3.rgb(l.R,l.G,l.B)}}}(i);return c},colorPalette=function(e){var t=[],a=(e.select(".palettePreview"),{});return dispatch.on("addSelectedColor.colorPalette",function(){var e=d3.rgb(this.selectedColor).toString();t.indexOf(e)>-1||a.addColorToPalette(this.selectedColor)}),dispatch.on("clearPalette.colorPalette",function(){t=[],e.select("tbody").selectAll("tr").remove()}),dispatch.on("deletePaletteColor.colorPalette",function(){var a=t.indexOf(this.color);t.splice(a,1),e.select("tbody").selectAll("tr").each(function(e,t){t===a&&d3.select(this).remove()})}),a.addColorToPalette=function(a){var l=d3.jab(a),r=d3.lab(a),o=d3.rgb(a);t.push(o.toString());var n="Jab("+[l.J,l.a,l.b].map(Math.round).join(",")+")",c="Lab("+[r.l,r.a,r.b].map(Math.round).join(",")+")",i=e.select("tbody").append("tr");i.append("td").append("span").classed("deletePaletteTableColor",!0).text("×").on("click",function(){var e=d3.select(this.parentNode.parentNode).select(".swatch").style("background-color");dispatch.call("deletePaletteColor",{color:d3.rgb(e).toString()})}),e.selectAll('tbody input[type="radio"]').property("checked",!1),i.append("td").append("input").attr("type","radio").property("checked",!0).on("click",function(){d3.selectAll('.paletteTable tbody input[type="radio"]').property("checked",!1),d3.select(this).property("checked",!0),dispatch.call("updateSelectedColor",{selectedColor:o})}),i.append("td").classed("swatch",!0).style("background",a),i.append("td").text(rgb2hex(a)),i.append("td").text(o.toString().replace(/\s/g,"")),i.append("td").text(c),i.append("td").text(n)},a},colorStore=function(){var e=[],t=[];return dispatch.on("addSelectedColor.colorStore",function(){colorDB.addColor(this.selectedColor)}),{addColor:function(a){e.push(a),t.push(d3.rgb(a))},getColors:function(){return e},getRGBColors:function(){return t}}},colorpicker=function(e){function t(t){"rgb"===s?y.range([255,0]):y.range([100,0]);var a=d3.scaleLinear().domain(y.range()).range(y.domain());e.select(".thumb").attr("transform","translate(0,"+a(t)+")")}function a(e){var t,a,l,r,o=d3.select("#colorpicker_square").node(),n=o.getContext("2d"),c=o.height,i=o.width,p=n.createImageData(i,c),u=d3.scaleLinear().domain([0,i]).range([359,0]),f=d3.scaleLinear().domain([c,0]).range([0,135]),g=d3.scaleLinear().domain([0,i]).range([-115,115]),v=d3.scaleLinear().domain([0,i]).range([-45,45]),b=colorDB.getRGBColors(),y=-1;for(l=c;l>0;l--)for(r=i;r>0;r--)t=!0,d&&(t=b.reduce(function(e,t){return e&&d3.noticeablyDifferent(t,a,.3)},!0)),!1===t?a=h:"rgb"===s?a=d3.rgb(e,r,l):("lab"===s?a=d3.lab(e,-g(r),g(l)):"hcl"===s?a=d3.hcl(u(r),f(l),e):((a=d3.jab(e,-v(r),v(l))).J<42&&a.b>25||a.J<10&&a.b>12||a.J<4&&a.b>7||a.J<2&&(a.b>3||a.a<-8||a.a>8))&&(a=h),a=!1===a.displayable()?h:d3.rgb(a)),p.data[++y]=a.r,p.data[++y]=a.g,p.data[++y]=a.b,p.data[++y]=255;n.putImageData(p,0,0)}function l(){var e,t,a=d3.select("#colorpicker_bar").node(),l=a.getContext("2d"),r=a.height,o=a.width,n=l.createImageData(1,r),c=-1,i=d3.scaleLinear().domain([0,r]).range("rgb"===s?[0,255]:[0,100]);for(t=r;t>0;t--)"rgb"===s?e=d3.rgb(i(t),0,0):"hcl"===s?e=d3.rgb(d3.hcl(0,0,i(t))):"lab"===s?e=d3.rgb(d3.lab(i(t),0,0)):"jab"===s&&(e=d3.rgb(d3.jab(i(t),0,0))),n.data[++c]=e.r,n.data[++c]=e.g,n.data[++c]=e.b,n.data[++c]=255;for(x=0;x<o;x++)l.putImageData(n,x,0)}function r(e){n(e,".colorChannelInput")}function o(e){n(e,".colorChannelInputHover")}function n(e,t){var a={rgb:d3.rgb(e),jab:d3.jab(e),lab:d3.lab(e),hcl:d3.hcl(e)};a.hex="#"+rgb2hex(a.rgb.toString()),d3.selectAll(t).each(function(){var e=d3.select(this),t=e.attr("data-colorType");if("hex"===t)e.property("value",a.hex);else{var l=a[t],r=Math.round(l[e.attr("data-channel")]);!1===isNaN(r)?e.node().value=r:e.node().value=null}})}function c(){if(""===this.value)this.value=m;else{var e,o=d3.select(this).attr("data-colorType");if("hex"===o)e=d3.rgb(this.value).toString();else{var n='.colorChannelInput[data-colorType="'+o+'"]',c=[];d3.selectAll(n).each(function(){c.push(this.value)}),e="hcl"!==o?d3[o](c[0],c[1],c[2]).toString():d3[o](c[2],c[1],c[0]).toString()}r(e),d3.select(".selectedColor").style("background",e);d3.select(".selectedColor");var i,d=d3[s](e);a(i="jab"===s?d.J:"lab"===s||"hcl"===s?d.l:d.r),l(),t(i)}}var i,d=!1,s="lab",p=[50,0,0],u={space:s,value:p,color:d3[s].apply(this,p)},h=d3.rgb("#282c34");i="jab"===s?u.color.J:"lab"===s||"hcl"===s?u.color.l:u.color.r,e.select(".selectedColor").style("background",u.color.toString()),r(u.color.toString()),a(i),l(),e.select("#addColorToPaletteBtn").on("click",function(){dispatch.call("addSelectedColor",{selectedColor:e.select(".selectedColor").style("background-color")})}),e.selectAll("#colorspaceSwitcherMenu li").on("click",function(){e.selectAll("#colorspaceSwitcherMenu li").classed("active",!1),d3.select(this).classed("active",!0);var r=d3.select(this).attr("data-space");if(r!==s){s=r;var o,n=e.select(".selectedColor").style("background-color"),c=d3[s](n);a(o="jab"===s?c.J:"lab"===s||"hcl"===s?c.l:c.r),l(),t(o)}}),e.selectAll(".colorChannelInput").on("focus",function(){m=this.value}).on("blur",c),e.selectAll('.colorChannelInput[type="color"]').on("change",c),e.select(".freetextColorInput").on("blur",function(){var a=d3.rgb(this.value.replace(/\'/g,"").replace(/\"/g,""));if(this.value="",NaN!==a.opacity&&(a.opacity=1),a.displayable()){r(a.toString()),e.select(".selectedColor").style("background-color",a);t("jab"===s?d3.jab(a).J:"lab"===s||"hcl"===s?d3.lab(a).l:a.r)}}),e.select("#colorpicker_square").on("click",function(){var e="rgba("+this.getContext("2d").getImageData(d3.mouse(this)[0],d3.mouse(this)[1],1,1).data.slice(0,4).join(",")+")";d3.select(".selectedColor").style("background",e),r(e)}).on("mousemove",function(){var t="rgba("+this.getContext("2d").getImageData(d3.mouse(this)[0],d3.mouse(this)[1],1,1).data.slice(0,4).join(",")+")";e.select(".hoverColor").style("background",t),o(t)});var f=e.select("#colorpicker_slider"),g={top:10,right:0,bottom:10,left:0},v=f.select(".thumb"),b=+f.style("height").replace("px",""),y=d3.scaleLinear().domain([0,b-g.top]);v.attr("transform","translate(0,"+(b/2-g.top)+")"),v.call(d3.drag().on("drag",function(){"rgb"===s?y.range([255,0]):y.range([100,0]);var e,t=b-g.bottom;e=d3.event.y<0?0:d3.event.y>t?t:d3.event.y,d3.select(this).attr("transform","translate(0,"+e+")"),a(y(e));var l=[y(e)];d3.selectAll(".colorChannelInput").filter(function(){return d3.select(this).attr("data-colorType")===s}).each(function(t,a){0!==a?l.push(+this.value):this.value=y(e)});var o;r(o="hcl"!==s?d3[s](l[0],l[1],l[2]):d3[s](l[2],l[1],l[0])),d3.select(".selectedColor").style("background-color",o.toString())})),dispatch.on("updateSelectedColor.colorpicker",function(){var o,n=this.selectedColor,c=d3[s](n);"jab"===s?o=c.J:"lab"===s||"hcl"===s?o=c.l:"rgb"===s&&(o=c.r),e.select(".selectedColor").style("background",c.toString()),r(c.toString()),a(o),l(),t(o)});var m},exportFunction=function(e){var t=[],a={},l=e.select(".paletteCanvas"),r=e.select(".paletteInputField"),o=e.select(".paletteShareField");dispatch.on("addSelectedColor.export",function(){var e=d3.rgb(this.selectedColor).toString();t.indexOf(e)>-1||(a.addColorToPalette(this.selectedColor),a.updatePaletteCanvas(),a.updatePaletteInputField(),a.updatePaletteShareField())}),dispatch.on("deletePaletteColor.export",function(){var e=t.indexOf(this.color);t.splice(e,1),a.updatePaletteCanvas(),a.updatePaletteInputField(),a.updatePaletteShareField()}),a.updatePaletteCanvas=function(){if(l.attr("width",200),0!==t.length){for(var e,a=l.attr("width"),r=l.node().getContext("2d"),o=r.createImageData(a,1),n=-1,c=Math.floor(a/t.length),i=-1,d=0;d<a;++d)d%c==0&&i!==t.length-1&&i++,(e=d3.rgb(t[i])).displayable()?(o.data[++n]=e.r,o.data[++n]=e.g,o.data[++n]=e.b,o.data[++n]=255):(o.data[++n]=0,o.data[++n]=0,o.data[++n]=0,o.data[++n]=255);r.putImageData(o,0,0)}},a.updatePaletteInputField=function(){r.property("value",'"'+t.join('","')+'"')},a.updatePaletteShareField=function(){var e;e=0===t.length?"":"?palette="+t.map(e=>e.toString().replace(/\s/g,"")).join(";"),o.property("value",document.location.host+document.location.pathname+e)},a.addColorToPalette=function(e){t.push(d3.rgb(e).toString())},r.on("blur",function(){if(""!==this.value){var e=this.value.replace(/\s/g,"").replace("[","").replace("]","").split('",');e.length<1||(dispatch.call("clearPalette"),t=[],(e=e.map(e=>e.replace(/\"/g,"")).filter(e=>d3.rgb(e).displayable())).forEach(a.addColorToPalette),e.forEach(e=>dispatch.call("addSelectedColor",{selectedColor:e})),a.updatePaletteCanvas(),r.property("value",'"'+e.join('","')+'"'))}})},cvdgradientpicker=function(e){function t(t,r){e.selectAll("tbody tr").each(function(){var e=d3.select(this),o=e.attr("data-cvdType"),n=cvd.colorTransforms[o];e.selectAll("td").filter((e,t)=>t>0).each(function(e,o){a(d3.select(this).select("canvas"),t,r,l[o],n)})})}function a(e,t,a,l,r){for(var o,n=e.attr("width"),c=e.node().getContext("2d"),i=c.createImageData(n,1),d=-1,s=d3["interpolate"+l[0].toUpperCase()+l.slice(1)],p=d3.scaleLinear().domain([0,n-1]).interpolate(s).range([t,a]),u=0;u<n;++u)o=d3.rgb(p(u)),void 0!==r&&(o=r(o)),o.displayable()?(i.data[++d]=o.r,i.data[++d]=o.g,i.data[++d]=o.b,i.data[++d]=255):(i.data[++d]=0,i.data[++d]=0,i.data[++d]=0,i.data[++d]=255);c.putImageData(i,0,0)}var l=["jab","lab","rgb"];t("black","white"),dispatch.on("updateGradientColors",function(){t(this.startColor,this.stopColor)})},gradientpicker=function(e){function t(){void 0===f&&void 0===g||void 0!==f&&void 0!==g&&(dispatch.call("updateGradientColors",{startColor:f,stopColor:g}),e.selectAll("canvas").each(function(){a(d3.select(this),f,g)}),e.selectAll(".gradientOutputText").each(function(){l(d3.select(this),f,g)}))}function a(e,t,a){for(var l,r=e.attr("width"),o=e.node().getContext("2d"),n=o.createImageData(r,1),c=-1,i=e.attr("data-colorType"),d=d3["interpolate"+i[0].toUpperCase()+i.slice(1)],s=d3.scaleLinear().domain([0,r-1]).interpolate(d).range([t,a]),p=0;p<r;++p)(l=d3.rgb(s(p))).displayable()?(n.data[++c]=l.r,n.data[++c]=l.g,n.data[++c]=l.b,n.data[++c]=255):(n.data[++c]=0,n.data[++c]=0,n.data[++c]=0,n.data[++c]=255);o.putImageData(n,0,0)}function l(e,t,a){var l=e.attr("data-colorType"),r=d3["interpolate"+l[0].toUpperCase()+l.slice(1)],o=d3.scaleLinear().domain([0,e.classed("sequential")?c-1:1]).interpolate(r).range([t,a]),n=Array.from(Array(c),(e,t)=>o(t));e.property("value",JSON.stringify(n))}function r(e){return function(){var a=d3.rgb(e.property("value"));a.displayable()&&(e.classed("gradientStartColor")?f=a:g=a,t())}}var o,n,c=5,i=[],d=e.select(".gradientPickerMenu"),s=d.select(".startColor .swatchList"),p=d.select(".stopColor .swatchList"),u=e.select(".gradientStartColor"),h=e.select(".gradientStopColor"),f="rgb(0, 0, 0)",g="rgb(255, 255, 255)";t(),e.selectAll(".gradientPickerInput").on("focus",function(){o=f,n=g}),u.on("blur",r(u)),h.on("blur",r(h)),e.select(".gradientStepCount").on("blur",function(){c=+this.value,e.selectAll(".sequential").attr("width",c),t()}),dispatch.on("addSelectedColor.gradientpicker",function(){var e=d3.rgb(this.selectedColor).toString();if(!(i.indexOf(e)>-1)){i.push(e);s.append("li").style("background-color",this.selectedColor).on("click",function(){f=e,t()}),p.append("li").style("background-color",this.selectedColor).on("click",function(){g=e,t()})}}),dispatch.on("clearPalette.gradientpicker",function(){i=[],d.selectAll("li").remove()}),dispatch.on("deletePaletteColor.gradientpicker",function(){var e=d3.rgb(this.color);d.selectAll("li").filter(function(){return d3.select(this).style("background-color")===e.toString()}).remove(),i.splice(i.indexOf(e.toString()),1)})},imageprocessor=function(e){var t=e.select("canvas").node(),a=t.getContext("2d"),l=e.select(".uniqueColors"),r=e.select(".dragArea"),o=e.select(".dropImg"),n=e.select(".uploadBtn");r.on("dragover",function(e){d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.dataTransfer.dropEffect="copy"}),r.on("drop",function(){d3.event.stopPropagation(),d3.event.preventDefault();var e=d3.event.dataTransfer.files;if(!(e.length<1)){var t=e[0];if(t.type.match("image.*")){var a=new FileReader;a.onload=function(e){o.node().src=e.target.result},a.readAsDataURL(t)}}}),o.on("load",function(){a.clearRect(0,0,t.width,t.height),a.drawImage(o.node(),0,0,t.width,t.height);for(var e=a.getImageData(0,0,t.width,t.height),r=Array(t.width*t.height),n=-1,c=0;c<t.width*t.height;++c)r[c]=d3.hcl(d3.rgb(e.data[++n],e.data[++n],e.data[++n]).toString()),++n;var i=r.filter(function(e,t,a){return a.indexOf(e)===t}).reduce(function(e,t,a){if(0===e.length)return[t];for(var a=0,a=0;a<e.length;a++)if(!1===d3.noticeablyDifferent(e[a],t,1,.5))return e;return e.push(t),e},[]).sort(function(e,t){var a=e.h-t.h;if(Math.abs(a)>15)return a;var l=e.l-t.l;return Math.abs(l)>5?l:e.c-t.c});l.selectAll("li").remove(),l.selectAll("li").data(i).enter().append("li").style("background-color",e=>e).on("click",function(e){dispatch.call("addSelectedColor",{selectedColor:e.toString()})})}),n.on("click",function(){var t=e.select('.uploadForm input[type="file"]');if(t.property("files").length>0){var a=new FileReader;a.onload=function(e){o.node().src=e.target.result},a.readAsDataURL(t.property("files")[0])}})},cvdtable=function(e){function t(){var t=[];return e.select(".palette").selectAll("td").each(function(e,a){0!==a&&t.push(d3.select(this).style("background-color"))}),t}function a(){e.selectAll("tbody tr").each(function(){var e=d3.select(this),t=(e.attr("class"),[]);e.selectAll("td").each(function(e,a){0!==a&&t.push(d3.select(this).style("background-color"))}),e.selectAll("td").each(function(e,a){if(0!==a){var l=d3.select(this),n=l.style("background-color"),c=t.indexOf(n),i=t.reduce(function(e,t,a){if(a===c)return e;var l=d3.noticeablyDifferent(t,n,o,r);return e&&l},!0);l.classed("notDifferent",!1===i).text(!1===i?"⚠":""),d3.lab(n).l<30&&l.style("color","rgba(255,255,255,0.25)")}})})}var l={},r=.5,o=.1;return l.addColorToTable=function(l){var r=d3.rgb(l).toString();t().indexOf(r)>-1||(e.selectAll("tbody tr").each(function(){var e,t=d3.select(this),a=t.attr("class");e="palette"===a?r:cvd.colorTransforms[a](r),t.append("td").style("background-color",e)}),a())},dispatch.on("addSelectedColor.cvdtable",function(){l.addColorToTable(this.selectedColor)}),dispatch.on("clearPalette.cvdtable",function(){curPalette=[],e.selectAll("tr").each(function(){d3.select(this).selectAll("td").filter((e,t)=>t>0).remove()})}),dispatch.on("deletePaletteColor.cvdtable",function(){var l=t().indexOf(d3.rgb(this.color).toString());e.selectAll("tr").each(function(){d3.select(this).selectAll("td").filter((e,t)=>t>0).filter((e,t)=>t===l).remove()}),a()}),dispatch.on("updateJNDParameters.cvdTable",function(){r=this.percent,o=this.size,a()}),l},jndtable=function(e){function t(){var e=+i.property("value"),t=+d.property("value"),a=2*Math.atan(t/2/e);a=180*a/Math.PI,c.text(d3.format(".3f")(a))}function a(){var t=[];return e.select(".palette").selectAll("td").each(function(e,a){0!==a&&t.push(d3.select(this).style("background-color"))}),t}var l=.5,r=.1,o={},n=e.select(".jndParameters");o.addColorToTable=function(t){var o=d3.rgb(t).toString(),n=a(),c=e.select(".palette");if(!(n.indexOf(o)>-1)){c.append("td").style("background-color",o),e.selectAll(".ndRow").each(function(e,t){var a=n[t],c=d3.select(this).append("td");!1===d3.noticeablyDifferent(o,a,r,l)&&c.classed("notDifferent",!0).text("⚠")});var i=e.select("tbody").append("tr").classed("ndRow",!0);i.append("td").style("background-color",o),n.forEach(function(e){var t=i.append("td");!1===d3.noticeablyDifferent(o,e,r,l)&&t.classed("notDifferent",!0).text("⚠")}),i.append("td")}},o.updateColorTable=function(){var t=a();e.selectAll(".ndRow").each(function(e,a){var o=t[a];d3.select(this).selectAll("td").filter((e,t)=>t>0).each(function(e,a){var n=t[a];if(n!==o){var c=d3.noticeablyDifferent(n,o,r,l);d3.select(this).classed("notDifferent",!c).text(c?"":"⚠")}})})},dispatch.on("addSelectedColor.jndtable",function(){o.addColorToTable(this.selectedColor)}),dispatch.on("clearPalette.jndtable",function(){curPalette=[];var t=e.selectAll(".palette td").filter((e,t)=>t>0),a=e.selectAll(".ndRow");t.remove(),a.remove()}),dispatch.on("deletePaletteColor.jndtable",function(){var t=a(),l=t.indexOf(d3.rgb(this.color).toString()),r=e.selectAll(".palette td").filter((e,t)=>t>0),o=e.selectAll(".ndRow");t.splice(l,1),r.filter((e,t)=>t===l).remove(),r.each(function(e,t){t===l&&d3.select(this).remove()}),o.each(function(e,t){var a=d3.select(this);if(t!==l){var r=a.style("background-color"),o=a.selectAll("td").filter((e,t)=>t>0);o.filter((e,t)=>t===l).remove(),o.each(function(e,t){var a=d3.select(this),l=a.style("background-color");if(l!==r){var o=!d3.noticeablyDifferent(l,r);a.classed("notDifferent",o).text(o?"⚠":"")}})}else a.remove()})}),n.selectAll("li").each(function(){var e=d3.select(this),t=e.attr("data-parameter"),a=e.select(".value");e.select("input").on("input",function(){var e=+d3.select(this).property("value");"percent"===t?(l=e,e=e.toFixed(2).replace("0.","").replace(".","")+"%"):"size"===t&&(r=e,e=e.toFixed(2)),a.text(e),o.updateColorTable(),dispatch.call("updateJNDParameters",{percent:l,size:r})})});var c=e.select(".visualangle_va"),i=e.select(".visualangle_distance"),d=e.select(".visualangle_size");return i.on("blur",t),d.on("blur",t),t(),o},palettepreview=function(e){function t(){a.selectAll("li").style("width",1/l.length*100+"%")}var a=e.select("ul"),l=[],r={};return r.addColorToPreview=function(e){a.append("li").style("background-color",e).on("click",function(){var e=d3.select(this).style("background-color");dispatch.call("deletePaletteColor",{color:e})}),l.push(d3.rgb(e).toString()),t()},dispatch.on("addSelectedColor.palettePreview",function(){var e=d3.rgb(this.selectedColor).toString();l.indexOf(e)>-1||r.addColorToPreview(this.selectedColor)}),dispatch.on("clearPalette.palettePreview",function(){l=[],a.selectAll("li").remove()}),dispatch.on("deletePaletteColor.palettePreview",function(){var e=l.indexOf(this.color);e<0||(a.selectAll("li").each(function(t,a){a===e&&d3.select(this).remove()}),l.splice(e,1),t())}),r},uri=function(){var e=[],t=document.location.search.split("&").filter(e=>e.indexOf("palette=")>-1);if(0!==t.length){var a=(t=t[0].replace("?","").replace("palette=","").split(";")).map(e=>d3.rgb(e)).filter(e=>e.displayable());e=a.map(e=>e.toString()),(e=e.filter((t,a)=>e.indexOf(t)===a)).length>0&&e.forEach(e=>dispatch.call("addSelectedColor",{selectedColor:e}))}},vispreview=function(e){function t(){var e=n.attr("width")-d.left-d.right,t=n.attr("height")-d.top-d.bottom,a=d3.scaleBand().domain(o).range([0,e]).padding(.1),l=d3.scaleLinear().domain([0,1]).range([t,0]),r=n.select(".bars").selectAll("rect").data(o);r.enter().append("rect").each(function(){for(var e=d3.select(this),a=0;a<.25;)a=l(Math.random());e.attr("y",a).attr("height",t-a)}).merge(r).style("fill",e=>e).attr("x",e=>a(e)).attr("width",a.bandwidth()),r.exit().remove()}function a(){c.selectAll("polygon").style("fill",(e,t)=>o[f[t]%o.length]).style("stroke",(e,t)=>u.SHOW_STROKE?u.STROKE_COLOR:"none").style("stroke-width",(e,t)=>u.STROKE_WIDTH)}function l(){i.select(".circles").selectAll("circle").attr("r",p.RADIUS).style("fill",(e,t)=>p.SHOW_FILL?o[t%o.length]:"none").style("stroke",(e,t)=>p.SHOW_STROKE?o[t%o.length]:"none").style("stroke-width",(e,t)=>p.STROKE_WIDTH)}function r(e,t){var a=+e.attr("width")-d.left-d.right,l=+e.attr("height")-d.top-d.bottom,r=e.append("g").attr("transform","translate("+d.left+","+d.top+")"),o=d3.scaleLinear().domain([0,1]).range([0,a]),n=d3.scaleLinear().domain([0,1]).range([l,0]);return t&&(r.append("g").attr("transform","translate(0,"+l+")").call(d3.axisBottom(o).ticks(0)),r.append("g").call(d3.axisLeft(n).ticks(0))),{height:l,margin:d,svg:r,width:a,x:o,y:n}}for(var o=[],n=e.select(".barPreview"),c=e.select(".mapPreview"),i=e.select(".scatterPreview"),d={top:15,right:15,bottom:20,left:15},s={},p={RADIUS:5,SHOW_FILL:!1,SHOW_STROKE:!0,STROKE_WIDTH:1},u={SHOW_STROKE:!0,STROKE_COLOR:"white",STROKE_WIDTH:1},h=c.selectAll("polygon").size(),f=new Array(h),g=0;g<h;g++)f[g]=g;f=d3.shuffle(f),function(){var e=r(n,!0);e.margin,e.width,e.height;e.svg.append("g").classed("bars",!0)}(),function(){for(var e=r(i,!0),t=(e.margin,e.width,e.height,e.svg),a=e.x,l=e.y,o=t.append("g").classed("circles",!0),n=0;n<100;n++)o.append("circle").attr("cx",a(Math.random())).attr("cy",l(Math.random())).attr("r",p.RADIUS).style("stroke-width",(e,t)=>p.STROKE_WIDTH)}(),e.select(".scatterOptions_radius").on("input",function(){p.RADIUS=+d3.select(this).property("value"),l()}),e.select(".scatterOptions_showStroke").on("change",function(){p.SHOW_STROKE=!p.SHOW_STROKE,l()}),e.select(".scatterOptions_showFill").on("change",function(){p.SHOW_FILL=!p.SHOW_FILL,l()}),e.select(".scatterOptions_stroke_width").on("input",function(){p.STROKE_WIDTH=+d3.select(this).property("value"),l()}),e.select(".mapOptions_showStroke").on("change",function(){u.SHOW_STROKE=!u.SHOW_STROKE,a()}),e.select(".mapOptions_stroke_color").on("blur",function(){u.STROKE_COLOR=d3.select(this).property("value"),a()}),e.select(".mapOptions_stroke_width").on("input",function(){u.STROKE_WIDTH=+d3.select(this).property("value"),a()}),dispatch.on("addSelectedColor.visPreview",function(){var e=d3.rgb(this.selectedColor).toString();o.indexOf(e)>-1||s.addColorToPalette(e)}),dispatch.on("clearPalette.visPreview",function(){o=[],l(),t(),a()}),dispatch.on("deletePaletteColor.visPreview",function(){var e=d3.rgb(this.color).toString(),r=o.indexOf(e);r<0||(o.splice(r,1),l(),t(),a())}),s.addColorToPalette=function(e){o.push(e),l(),t(),a()}},cvd=colorVisionDeficiency(),colorDB=colorStore(),exprt=exportFunction(d3.select(".exportOptionsContainer")),cp=colorpicker(d3.select(".colorpicker")),ip=imageprocessor(d3.select(".imageProcessor")),palette=colorPalette(d3.select(".paletteTable")),gp=gradientpicker(d3.select(".gradientPicker")),jnds=jndtable(d3.select(".jndTable")),cvdTable=cvdtable(d3.select(".cvdTable")),cvdGrads=cvdgradientpicker(d3.select(".cvdGradientPicker")),palettePreview=palettepreview(d3.select(".palettePreview")),visPreview=vispreview(d3.select(".visPreview")),processUriPalette=uri();d3.selectAll(".hiddenMenu").each(function(){var e=d3.select(this),t=e.select(".hiddenMenuTitle"),a=e.select(".hiddenMenuContent");t.on("click",function(){var e="hidden"===a.style("visibility");a.style("visibility",e?"visible":"hidden").style("display",e?"inline-block":"none")})});